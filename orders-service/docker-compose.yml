services:
  orders:
    image: node:18-alpine
    working_dir: /app
    volumes: [ "./:/app" ]
    command: ["npm", "start"]
    env_file: [ ".env" ]
    ports: [ "13004:3004" ]
    depends_on: [ orders_db ]
    restart: unless-stopped

  orders_db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: "${DB_PASSWORD:-root}"
      MYSQL_DATABASE: "${DB_NAME:-orders_db}"
    ports: [ "13309:3306" ]
    command: ["--default-authentication-plugin=mysql_native_password"]
    volumes: [ "orders_db_data:/var/lib/mysql" ]
    restart: unless-stopped

  mongo_logs:
    image: mongo:6
    ports: [ "27030:27017" ]
    volumes: [ "orders_mongo_data:/data/db" ]
    restart: unless-stopped

volumes:
  orders_db_data:
  orders_mongo_data:
